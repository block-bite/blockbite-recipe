(function(u,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(u=typeof globalThis<"u"?globalThis:u||self,a(u.Recipe={}))})(this,function(u){"use strict";var N=Object.defineProperty;var q=(u,a,g)=>a in u?N(u,a,{enumerable:!0,configurable:!0,writable:!0,value:g}):u[a]=g;var x=(u,a,g)=>q(u,typeof a!="symbol"?a+"":a,g);const f=class f{constructor(r,e,t={}){if(r==="store"){this._isStore=!0,this._storeName=t.name||"store",this._useLocalStorage=t.localStorage||!1,this.store=this._initStore(e),this.watch=(s,i)=>{var o;this._storeWatchers??(this._storeWatchers={}),(o=this._storeWatchers)[s]??(o[s]=[]),this._storeWatchers[s].push(i)},f.store.set(this._storeName,this.store),f._storeInstanceMap??(f._storeInstanceMap=new Map),f._storeInstanceMap.set(this._storeName,this);return}this.root=document.querySelector(r),this.queue=[],this.bindings={},this.watchers={},this._state={},this.store=new Proxy({},{set:(s,i,o)=>{var n,c;if(s[i]=o,!isNaN(i)||i==="length"){this._saveStore(s),subscribers.forEach(m=>m(s));const l=(n=f._storeInstanceMap)==null?void 0:n.get(this._storeName),d=(c=l==null?void 0:l._storeWatchers)==null?void 0:c[i];d&&d.forEach(m=>{var h;m(o,(h=l._getRuntime)==null?void 0:h.call(l,document.body))})}return!0},get:(s,i)=>s[i]}),setTimeout(()=>this._runQueue(),0)}text(r,e){const t=this.root.querySelector(`[r-text="${r}"]`)||this.root.querySelector(`[data-r-text="${r}"]`);t&&(t.textContent=e)}loop(){const r=this.root.querySelector("[r-loop]");if(!r)return{effect:()=>{},bind:{}};const e=r.parentElement,t=r.cloneNode(!0),s={click:[]},i={effect:(o,n=[])=>{const c=l=>{e.querySelectorAll("[data-r-loop-item]").forEach(d=>d.remove()),l.forEach((d,m)=>{const h=t.cloneNode(!0);h.removeAttribute("r-loop"),h.setAttribute("data-r-loop-item",""),h.setAttribute("data-r-item",JSON.stringify(d)),n.forEach(b=>{const S=h.querySelector(`[r-text="${b}"]`);S&&(S.textContent=d[b])}),s.click.forEach(({selector:b,handler:S})=>{h.querySelectorAll(b).forEach(p=>{p.addEventListener("click",()=>{const E=this._getRuntime(p);S(m,E)})})}),e.appendChild(h)})};return o!=null&&o.__subscribe&&o.__subscribe(c),c(o),r.remove(),i},bind:{click:o=>n=>(console.log("âœ… registered bind.click for",o),s.click.push({selector:o,handler:n}),i)}};return i}_initStore(r){let e=null;if(this._useLocalStorage){const o=localStorage.getItem(this._storeName);if(o)try{e=JSON.parse(o)}catch{console.warn("ðŸ“š Recipe Failed to parse localStorage data for store:",this._storeName)}}const t=e||r,s=[],i=new Proxy([...t],{set:(o,n,c)=>{var l;if(o[n]=c,!isNaN(n)||n==="length"){this._saveStore(o),s.forEach(m=>m(o));const d=(l=this._storeWatchers)==null?void 0:l[n];d&&d.forEach(m=>{var h;m(c,(h=this._getRuntime)==null?void 0:h.call(this,document.body))})}return!0},get:(o,n)=>n==="__subscribe"?c=>s.push(c):o[n]});return this._saveStore(i),i}_saveStore(r){this._useLocalStorage&&localStorage.setItem(this._storeName,JSON.stringify(r))}click(r){const e=this,t=s=>(e.queue.push(()=>{(r?e.root.querySelectorAll(r):[e.root]).forEach((o,n)=>{if(!o){console.warn(`ðŸ“š Recipe Element not found for direct selector: ${r}`);return}o.addEventListener("click",()=>{const c=e._getRuntime(o);s(n,c),t._label&&e._dispatch(t._label,n,c)})})}),t);return t.label=function(s){return t._label=s,t},t}bind(r,e){this.bindings[r]=(t,s)=>{e(t,s)}}watch(r,e){this.watchers[r]=(t,s)=>{e(t,s)}}_dispatch(r,e,t){this.bindings[r]&&this.bindings[r](e,t)}_runQueue(){this.queue.forEach(r=>r()),this.queue=[]}_getRuntime(r){const e=this;return{el:r,class:{add:t=>r.classList.add(t),remove:t=>r.classList.remove(t)},q(t){const s=e.root||document;return g(s.querySelectorAll(t))},parent:{data:{set:(t,s)=>{e.store[t]=s,e.root.setAttribute(`data-${t}`,s)},get:t=>e.store[t]}},getItem(){const t=r.getAttribute("data-r-item");if(!t){const s=r.closest("[data-r-item]");if(s)return JSON.parse(s.getAttribute("data-r-item"))}try{return JSON.parse(t)}catch{return console.warn("ðŸ“š Recipe Failed to parse data-r-item attribute:",t),null}}}}};x(f,"store",new Map);let a=f;function g(_){return{class:{add:r=>_.forEach(e=>e.classList.add(r)),remove:r=>_.forEach(e=>e.classList.remove(r))},eq(r){const e=_[r];return{class:{add:t=>e==null?void 0:e.classList.add(t),remove:t=>e==null?void 0:e.classList.remove(t)},text:(t,s)=>{const i=(e==null?void 0:e.querySelector(`[r-text="${t}"]`))||(e==null?void 0:e.querySelector(`[data-r-text="${t}"]`));i&&(i.textContent=s)}}},text:(r,e)=>{_.forEach(t=>{t.textContent=e})}}}u.Recipe=a,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
